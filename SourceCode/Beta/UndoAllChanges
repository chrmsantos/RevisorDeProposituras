'--------------------------------------------------------------------------------
' Botão: Desfazer todas as alterações
'--------------------------------------------------------------------------------
' SUBROTINA: UndoAllChanges
' Finalidade: Desfaz todas as alterações realizadas no documento ativo.
'--------------------------------------------------------------------------------
Sub UndoAllChanges()
    On Error GoTo ErrorHandler

    ' Verifica se há um documento ativo
    If Documents.Count = 0 Then
        MsgBox "Nenhum documento está aberto para desfazer alterações.", vbExclamation, "Documento não encontrado"
        Exit Sub
    End If

    Dim doc As Document: Set doc = ActiveDocument

    ' Verifica se há alterações a serem desfeitas
    If doc.Saved Then
        MsgBox "Nenhuma alteração foi realizada desde o último salvamento.", vbInformation, "Nada a desfazer"
        Exit Sub
    End If

    ' Desativa atualizações para melhorar o desempenho
    Application.ScreenUpdating = False

    ' Desfaz todas as alterações realizadas no documento
    Dim undoCount As Long: undoCount = 0
    Dim maxUndo As Long: maxUndo = 1000 ' Limite de operações de desfazer (ajustável)
    
    Do While doc.Undo
        undoCount = undoCount + 1
        If undoCount >= maxUndo Then Exit Do ' Evita loops infinitos em documentos muito grandes
    Loop

    ' Restaura configurações
    Application.ScreenUpdating = True

    ' Mensagem de conclusão
    MsgBox "Todas as alterações realizadas desde a abertura do arquivo ou do último salvamento foram desfeitas com sucesso.", _
           vbInformation, "Alterações Desfeitas"
    Exit Sub

ErrorHandler:
    ' Restaura configurações em caso de erro
    Application.ScreenUpdating = True
    MsgBox "Erro " & Err.Number & ": " & Err.Description, vbCritical, "Erro ao Desfazer Alterações"
End Sub
